"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const util_1 = require("util");
const FILENAME = "package.json";
const ENCODING = "utf8";
function exists() {
    return fs.existsSync(FILENAME);
}
exports.exists = exists;
let cached = null;
let lastReadHadNewlineAtEOF = false;
function read() {
    if (cached === null) {
        const data = fs.readFileSync(FILENAME, { encoding: ENCODING });
        cached = JSON.parse(data);
        lastReadHadNewlineAtEOF = data.endsWith("\n");
    }
    return cached;
}
function write(config) {
    let data = JSON.stringify(config, null, 2);
    if (lastReadHadNewlineAtEOF) {
        data += "\n";
    }
    fs.writeFileSync(FILENAME, data, { encoding: ENCODING });
    invalidateCache();
}
function update(func) {
    const data = read();
    func(data);
    write(data);
}
function invalidateCache() {
    cached = null;
}
function getVersion() {
    const data = read();
    if (!util_1.isString(data.version)) {
        throw new Error("no version");
    }
    return data.version;
}
exports.getVersion = getVersion;
function setVersion(ver) {
    update(data => { data.version = ver; });
}
exports.setVersion = setVersion;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2FnZWpzb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvcGFja2FnZWpzb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx5QkFBeUI7QUFDekIsK0JBQWdDO0FBRWhDLE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQztBQUNoQyxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUM7QUFFeEIsU0FBZ0IsTUFBTTtJQUNwQixPQUFPLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDakMsQ0FBQztBQUZELHdCQUVDO0FBTUQsSUFBSSxNQUFNLEdBQXlCLElBQUksQ0FBQztBQUN4QyxJQUFJLHVCQUF1QixHQUFZLEtBQUssQ0FBQztBQUc3QyxTQUFTLElBQUk7SUFDWCxJQUFJLE1BQU0sS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUMvRCxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQWtCLENBQUM7UUFDM0MsdUJBQXVCLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUMvQztJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxTQUFTLEtBQUssQ0FBQyxNQUFxQjtJQUNsQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDM0MsSUFBSSx1QkFBdUIsRUFBRTtRQUMzQixJQUFJLElBQUksSUFBSSxDQUFDO0tBQ2Q7SUFDRCxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUN6RCxlQUFlLEVBQUUsQ0FBQztBQUNwQixDQUFDO0FBRUQsU0FBUyxNQUFNLENBQUMsSUFBbUM7SUFDakQsTUFBTSxJQUFJLEdBQUcsSUFBSSxFQUFFLENBQUM7SUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ1gsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2QsQ0FBQztBQUVELFNBQVMsZUFBZTtJQUN0QixNQUFNLEdBQUcsSUFBSSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxTQUFnQixVQUFVO0lBQ3hCLE1BQU0sSUFBSSxHQUFHLElBQUksRUFBRSxDQUFDO0lBQ3BCLElBQUksQ0FBQyxlQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7S0FDL0I7SUFDRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7QUFDdEIsQ0FBQztBQU5ELGdDQU1DO0FBRUQsU0FBZ0IsVUFBVSxDQUFDLEdBQVc7SUFDcEMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxQyxDQUFDO0FBRkQsZ0NBRUMifQ==